# æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### è®¾è®¡åŸåˆ™

æœ¬æ¡†æ¶éµå¾ª **Linux å†…æ ¸çš„è®¾è®¡å“²å­¦**ï¼š

1. **æ¨¡å—åŒ–**: æ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€ï¼Œè¾¹ç•Œæ¸…æ™°
2. **åˆ†å±‚è®¾è®¡**: æ ¸å¿ƒå±‚ã€æœåŠ¡å±‚ã€æ¥å£å±‚åˆ†ç¦»
3. **å¯æ’æ‹”**: ç»„ä»¶å¯ä»¥ç‹¬ç«‹æ›¿æ¢å’Œæ‰©å±•
4. **é”™è¯¯å¤„ç†**: ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
5. **æ€§èƒ½ä¼˜å…ˆ**: æœ€å°åŒ–è¿è¡Œæ—¶å¼€é”€

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æ¥å£å±‚ (Interface Layer)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CLIå·¥å…·        â”‚  Python API      â”‚  å…¥å£ç‚¹æ–‡ä»¶            â”‚
â”‚  deepenc build  â”‚  deepenc.init()  â”‚  main.py/grpc_main.py â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœåŠ¡å±‚ (Service Layer)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ„å»ºæœåŠ¡        â”‚  å‘ç°æœåŠ¡        â”‚  åŠ è½½æœåŠ¡              â”‚
â”‚  ProjectBuilder â”‚  FileScanner     â”‚  ModuleLoader         â”‚
â”‚  Packager       â”‚  FileFilter      â”‚  ONNXLoader           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ¸å¿ƒå±‚ (Core Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŠ å¯†å¼•æ“        â”‚  æˆæƒç®¡ç†        â”‚  é”™è¯¯å¤„ç†              â”‚
â”‚  AESCrypto      â”‚  AuthManager     â”‚  Exception Classes    â”‚
â”‚  HardwareAuth   â”‚  LicenseManager  â”‚  Error Codes          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. åŠ å¯†å¼•æ“ (core/crypto.py)

```python
class AESCrypto:
    """AES-CFB åŠ å¯†å¼•æ“
    
    ç‰¹ç‚¹:
    - å›ºå®š IVï¼Œä¿æŒä¸åŸé¡¹ç›®å…¼å®¹
    - éƒ¨åˆ†åŠ å¯†ï¼Œä¼˜åŒ–å¤§æ–‡ä»¶æ€§èƒ½
    - ä¸¥æ ¼çš„é”™è¯¯å¤„ç†
    """
```

**è®¾è®¡è€ƒè™‘:**
- **å…¼å®¹æ€§**: ä¸åŸé¡¹ç›®çš„åŠ å¯†æ–¹å¼å®Œå…¨å…¼å®¹
- **æ€§èƒ½**: åªåŠ å¯†æ–‡ä»¶å‰ 10MBï¼Œå¤§å¤§æé«˜æ€§èƒ½
- **å®‰å…¨æ€§**: ä½¿ç”¨ AES-CFB æ¨¡å¼ï¼Œå¹³è¡¡å®‰å…¨æ€§å’Œæ€§èƒ½

### 2. æˆæƒç®¡ç† (core/auth.py)

```python
class AuthManager:
    """ç»Ÿä¸€æˆæƒç®¡ç†
    
    å¯†é’¥è·å–ä¼˜å…ˆçº§:
    1. ç¡¬ä»¶æˆæƒè®¸å¯è¯
    2. æ–‡ä»¶è®¸å¯è¯  
    3. ç¯å¢ƒå˜é‡
    """
```

**è®¾è®¡è€ƒè™‘:**
- **é™çº§æœºåˆ¶**: ç¡¬ä»¶æˆæƒä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§
- **å¤šæºæ”¯æŒ**: æ”¯æŒå¤šç§å¯†é’¥æ¥æº
- **ç¼“å­˜æœºåˆ¶**: é¿å…é‡å¤çš„æˆæƒæ£€æŸ¥

### 3. æ™ºèƒ½åŠ è½½å™¨ (loaders/)

```python
class SmartModuleLoader:
    """æ™ºèƒ½æ¨¡å—åŠ è½½å™¨
    
    åŠ è½½ä¼˜å…ˆçº§:
    1. å·²æ³¨å†Œçš„åŠ å¯†æ¨¡å—
    2. è‡ªåŠ¨å‘ç°çš„åŠ å¯†æ¨¡å—
    3. é™çº§åˆ°æ™®é€šæ¨¡å—
    """
```

**è®¾è®¡è€ƒè™‘:**
- **é€æ˜æ€§**: å®Œå…¨å…¼å®¹æ ‡å‡†çš„ import è¯­å¥
- **è‡ªåŠ¨å‘ç°**: æ— éœ€é…ç½®ï¼Œè‡ªåŠ¨å‘ç°åŠ å¯†æ–‡ä»¶
- **æ€§èƒ½ç¼“å­˜**: è§£å¯†åçš„å†…å®¹æ™ºèƒ½ç¼“å­˜

## ğŸ”„ å·¥ä½œæµç¨‹

### æ„å»ºæ—¶æµç¨‹

```mermaid
graph TD
    A[å¼€å§‹æ„å»º] --> B[æ‰«ææ–‡ä»¶]
    B --> C[è¿‡æ»¤æ–‡ä»¶]
    C --> D[è·å–å¯†é’¥]
    D --> E[åŠ å¯†Pythonæ–‡ä»¶]
    E --> F[åŠ å¯†ONNXæ¨¡å‹]
    F --> G[ç”Ÿæˆé…ç½®]
    G --> H[ç”Ÿæˆå¯åŠ¨è„šæœ¬]
    H --> I[æ„å»ºå®Œæˆ]
```

### è¿è¡Œæ—¶æµç¨‹

```mermaid
graph TD
    A[å¯åŠ¨åº”ç”¨] --> B[åˆå§‹åŒ–æˆæƒ]
    B --> C[å®‰è£…åŠ è½½å™¨]
    C --> D[æ³¨å†ŒåŠ å¯†æ¨¡å—]
    D --> E[æ­£å¸¸ä½¿ç”¨]
    
    E --> F{å¯¼å…¥æ¨¡å—}
    F -->|åŠ å¯†æ¨¡å—| G[è§£å¯†å¯¼å…¥]
    F -->|æ™®é€šæ¨¡å—| H[æ­£å¸¸å¯¼å…¥]
    
    E --> I{åŠ è½½æ¨¡å‹}
    I -->|åŠ å¯†æ¨¡å‹| J[è§£å¯†åŠ è½½]
    I -->|æ™®é€šæ¨¡å‹| K[æ­£å¸¸åŠ è½½]
```

## ğŸ” å®‰å…¨è®¾è®¡

### å¯†é’¥ç®¡ç†

```python
# å¯†é’¥è·å–ç­–ç•¥
def get_encryption_key():
    # 1. å°è¯•ç¡¬ä»¶æˆæƒ
    if hardware_available():
        return get_hardware_key()
    
    # 2. å°è¯•è®¸å¯è¯æ–‡ä»¶
    if license_file_exists():
        return get_license_key()
    
    # 3. ä½¿ç”¨ç¯å¢ƒå˜é‡
    return get_env_key()
```

### å†…å­˜å®‰å…¨

- **è§£å¯†å†…å®¹**: åªå­˜åœ¨äºå†…å­˜ä¸­ï¼Œä¸å†™å…¥ç£ç›˜
- **ä¸´æ—¶æ–‡ä»¶**: è‡ªåŠ¨æ¸…ç†ï¼Œè¿›ç¨‹é€€å‡ºæ—¶å¼ºåˆ¶æ¸…ç†
- **ç¼“å­˜ç®¡ç†**: æ™ºèƒ½ç¼“å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼

### é”™è¯¯æ¢å¤

- **é™çº§æœºåˆ¶**: åŠ å¯†æ–‡ä»¶ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨æ™®é€šæ–‡ä»¶
- **é”™è¯¯éš”ç¦»**: å•ä¸ªæ¨¡å—å¤±è´¥ä¸å½±å“æ•´ä¸ªç³»ç»Ÿ
- **çŠ¶æ€æ¢å¤**: æ”¯æŒç³»ç»Ÿé‡å¯å’ŒçŠ¶æ€æ¢å¤

## âš¡ æ€§èƒ½ä¼˜åŒ–

### åŠ è½½ä¼˜åŒ–

1. **å»¶è¿Ÿè§£å¯†**: åªåœ¨å®é™…ä½¿ç”¨æ—¶è§£å¯†
2. **æ™ºèƒ½ç¼“å­˜**: è§£å¯†åçš„å†…å®¹ç¼“å­˜åœ¨å†…å­˜ä¸­
3. **å¹¶è¡Œå¤„ç†**: æ”¯æŒå¤šæ–‡ä»¶å¹¶è¡ŒåŠ å¯†/è§£å¯†

### å†…å­˜ä¼˜åŒ–

1. **å¼±å¼•ç”¨ç¼“å­˜**: è‡ªåŠ¨é‡Šæ”¾ä¸å†ä½¿ç”¨çš„ç¼“å­˜
2. **åˆ†å—å¤„ç†**: å¤§æ–‡ä»¶åˆ†å—å¤„ç†ï¼Œå‡å°‘å†…å­˜å ç”¨
3. **èµ„æºå›æ”¶**: åŠæ—¶æ¸…ç†ä¸´æ—¶èµ„æº

### I/O ä¼˜åŒ–

1. **å¼‚æ­¥ I/O**: æ”¯æŒå¼‚æ­¥æ–‡ä»¶æ“ä½œ
2. **ç¼“å†²ä¼˜åŒ–**: ä¼˜åŒ–æ–‡ä»¶è¯»å†™ç¼“å†²
3. **è·¯å¾„ç¼“å­˜**: ç¼“å­˜æ–‡ä»¶è·¯å¾„æŸ¥æ‰¾ç»“æœ

## ğŸ”Œ æ‰©å±•æ€§è®¾è®¡

### æ’ä»¶æœºåˆ¶

```python
# è‡ªå®šä¹‰åŠ å¯†ç®—æ³•
class CustomCrypto:
    def encrypt(self, data, key):
        # è‡ªå®šä¹‰åŠ å¯†é€»è¾‘
        pass
    
    def decrypt(self, encrypted_data, key):
        # è‡ªå®šä¹‰è§£å¯†é€»è¾‘
        pass

# æ³¨å†Œè‡ªå®šä¹‰åŠ å¯†å™¨
encrypt.register_crypto_provider('custom', CustomCrypto())
```

### é’©å­ç³»ç»Ÿ

```python
# æ³¨å†Œé’©å­
@encrypt.on_module_loaded
def on_module_loaded(module_name, module):
    print(f"æ¨¡å—å·²åŠ è½½: {module_name}")

@encrypt.on_model_loaded  
def on_model_loaded(model_path, session):
    print(f"æ¨¡å‹å·²åŠ è½½: {model_path}")
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

- **æ ¸å¿ƒç»„ä»¶**: æ¯ä¸ªæ ¸å¿ƒç»„ä»¶éƒ½æœ‰å®Œæ•´çš„å•å…ƒæµ‹è¯•
- **è¾¹ç•Œæ¡ä»¶**: æµ‹è¯•å„ç§è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
- **å…¼å®¹æ€§**: æµ‹è¯•ä¸åŸé¡¹ç›®çš„å…¼å®¹æ€§

### é›†æˆæµ‹è¯•

- **ç«¯åˆ°ç«¯**: å®Œæ•´çš„æ„å»ºåˆ°è¿è¡Œæµç¨‹æµ‹è¯•
- **å¤šç¯å¢ƒ**: ä¸åŒæ“ä½œç³»ç»Ÿå’Œ Python ç‰ˆæœ¬æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**: å¤§æ–‡ä»¶å’Œé«˜å¹¶å‘åœºæ™¯æµ‹è¯•

### å®‰å…¨æµ‹è¯•

- **å¯†é’¥å®‰å…¨**: éªŒè¯å¯†é’¥ä¸ä¼šæ³„éœ²åˆ°æ—¥å¿—æˆ–ä¸´æ—¶æ–‡ä»¶
- **å†…å­˜å®‰å…¨**: éªŒè¯è§£å¯†å†…å®¹ä¸ä¼šæŒä¹…åŒ–
- **æƒé™æµ‹è¯•**: éªŒè¯æ–‡ä»¶æƒé™å’Œè®¿é—®æ§åˆ¶

## ğŸ“Š ç›‘æ§å’Œè¯Šæ–­

### æ—¥å¿—ç³»ç»Ÿ

```python
import logging

# é…ç½®æ—¥å¿—
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

# æ¡†æ¶ä¼šè‡ªåŠ¨è®°å½•å…³é”®æ“ä½œ
```

### æ€§èƒ½ç›‘æ§

```python
# è·å–æ€§èƒ½ç»Ÿè®¡
system = encrypt.get_system()
stats = system.get_performance_stats()

print(f"è§£å¯†æ“ä½œæ•°: {stats['decrypt_operations']}")
print(f"å¹³å‡è§£å¯†æ—¶é—´: {stats['avg_decrypt_time']:.3f}s")
print(f"ç¼“å­˜å‘½ä¸­ç‡: {stats['cache_hit_rate']:.2%}")
```

### è¯Šæ–­å·¥å…·

```bash
# è¯Šæ–­ç³»ç»ŸçŠ¶æ€
python -m encrypt status --verbose

# æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
python -m encrypt verify --check-integrity

# æ€§èƒ½åˆ†æ
python -m encrypt profile --module src.main
```

## ğŸ”§ å…¥å£ç‚¹æ–‡ä»¶ç®¡ç†

### è®¾è®¡ç†å¿µ

å…¥å£ç‚¹æ–‡ä»¶ç®¡ç†éµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

1. **ä¿æŠ¤æ€§**: å…¥å£ç‚¹æ–‡ä»¶ä¸è¢«åŠ å¯†ï¼Œä¿æŒåŸå§‹çŠ¶æ€
2. **çµæ´»æ€§**: æ”¯æŒè‡ªå®šä¹‰å…¥å£ç‚¹æ–‡ä»¶è·¯å¾„
3. **æ™ºèƒ½æ€§**: è‡ªåŠ¨è¯†åˆ«å’Œæ’é™¤å…¥å£ç‚¹æ–‡ä»¶
4. **ä¸€è‡´æ€§**: æ„å»ºåçš„ç›®å½•ç»“æ„æ¸…æ™°ä¸€è‡´

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å…¥å£ç‚¹æ–‡ä»¶ç®¡ç†                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡ä»¶è¯†åˆ«        â”‚  è·¯å¾„è§£æ        â”‚  æ’é™¤é€»è¾‘              â”‚
â”‚  EntryPoint     â”‚  PathResolver    â”‚  ExclusionFilter      â”‚
â”‚  Detector       â”‚                 â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥ä½œæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·æŒ‡å®šå…¥å£ç‚¹] --> B[è·¯å¾„è§£æå’ŒéªŒè¯]
    B --> C[æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥]
    C --> D[æ·»åŠ åˆ°æ’é™¤åˆ—è¡¨]
    D --> E[æ„å»ºæ—¶è·³è¿‡åŠ å¯†]
    E --> F[å¤åˆ¶åˆ°æ„å»ºç›®å½•]
    F --> G[è®¾ç½®æ‰§è¡Œæƒé™]
```

### æŠ€æœ¯å®ç°

```python
class EntryPointManager:
    """å…¥å£ç‚¹æ–‡ä»¶ç®¡ç†å™¨"""
    
    def __init__(self, entry_point=None):
        self.entry_point = Path(entry_point).resolve() if entry_point else None
    
    def should_exclude(self, file_path: str) -> bool:
        """åˆ¤æ–­æ–‡ä»¶æ˜¯å¦åº”è¯¥è¢«æ’é™¤"""
        if self.entry_point and str(self.entry_point) in file_path:
            return True
        return False
    
    def copy_to_build(self, build_dir: Path):
        """å¤åˆ¶å…¥å£ç‚¹æ–‡ä»¶åˆ°æ„å»ºç›®å½•"""
        if self.entry_point and self.entry_point.exists():
            target = build_dir / self.entry_point.name
            shutil.copy2(self.entry_point, target)
            target.chmod(0o755)  # è®¾ç½®æ‰§è¡Œæƒé™
```

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½

1. **åˆ†å¸ƒå¼ç¼“å­˜**: æ”¯æŒ Redis ç­‰åˆ†å¸ƒå¼ç¼“å­˜
2. **äº‘ç«¯å¯†é’¥**: æ”¯æŒäº‘ç«¯å¯†é’¥ç®¡ç†æœåŠ¡
3. **å®æ—¶æ›´æ–°**: æ”¯æŒåŠ å¯†æ–‡ä»¶çš„çƒ­æ›´æ–°
4. **å¤šç®—æ³•æ”¯æŒ**: æ”¯æŒæ›´å¤šåŠ å¯†ç®—æ³•
5. **Web ç®¡ç†ç•Œé¢**: æä¾› Web ç®¡ç†ç•Œé¢

### æ‰©å±•æ¥å£

æ¡†æ¶æä¾›äº†ä¸°å¯Œçš„æ‰©å±•æ¥å£ï¼Œæ”¯æŒï¼š

- è‡ªå®šä¹‰åŠ å¯†ç®—æ³•
- è‡ªå®šä¹‰æˆæƒæœºåˆ¶
- è‡ªå®šä¹‰æ–‡ä»¶è¿‡æ»¤å™¨
- è‡ªå®šä¹‰æ„å»ºæµç¨‹
- è‡ªå®šä¹‰åŠ è½½å™¨
